syntax = "proto3";

package gateway.v1;

import "google/protobuf/timestamp.proto";

enum GatewayStatus {
  // Unknown status
  GATEWAY_STATUS_UNSPECIFIED = 0;

  // Gateway is active and operational
  GATEWAY_STATUS_ACTIVE = 1;

  // Gateway is offline
  GATEWAY_STATUS_ERROR = 2;

  // Gateway is pending activation
  GATEWAY_STATUS_PENDING = 3;
}

enum GatewayType {
    // Unknown type
    GATEWAY_TYPE_UNSPECIFIED = 0;
    
    // EMQX Gateway
    GATEWAY_TYPE_EMQX = 1;
}

message EMQXGatewayConfig {
  // URL of the EMQX broker
  string broker_url = 1;
  string subscription_group = 2;
}


// Gateway represents a gateway registered in the system
// for ingesting data from end devices.
message Gateway {
  // Server-generated unique identifier (UUID format)
  string gateway_id = 1;

  // Organization that owns this gateway
  string organization_id = 2;

  // Human-readable name for the gateway
  string name = 3;

  // Current status of the gateway
  GatewayStatus status = 4;

  // Type of the gateway
  GatewayType type = 5;

  // When the gateway was created
  google.protobuf.Timestamp created_at = 6;

  // When the gateway was last updated
  google.protobuf.Timestamp updated_at = 7;

  // When the gateway was deleted
  google.protobuf.Timestamp deleted_at = 8;

  oneof config {
    // EMQX Gateway configuration
    EMQXGatewayConfig emqx_config = 9;
  }
}

// Request to create a gateway
// Device ID is generated server-side
message CreateGatewayRequest {
  // Organization that will own this device
  string organization_id = 1;

  // Human-readable name for the device
  string name = 2;

  GatewayType type = 3;

  oneof config {
    // EMQX Gateway configuration
    EMQXGatewayConfig emqx_config = 4;
  }
}

// Response containing the newly created gateway
message CreateGatewayResponse {
  // The created gateway with server-generated ID and timestamps
  Gateway gateway = 1;
}

// Request to get a gateway by ID
message GetGatewayRequest {
  // Unique identifier of the gateway to retrieve
  string gateway_id = 1;

  // Organization ID owning the gateway
  string organization_id = 2;
}

// Response containing the requested gateway
message GetGatewayResponse {
  // The requested gateway
  Gateway gateway = 1;
}

// Request to list all gateways for an organization
message ListGatewaysRequest {
  // Organization ID to filter gateways by
  string organization_id = 1;
}

// Response containing gateways for the organization
message ListGatewaysResponse {
  // List of gateways belonging to the organization
  // No pagination for initial implementation
  repeated Gateway gateways = 1;
}

// Request to update a gateway
message UpdateGatewayRequest {
  // Unique identifier of the gateway to update
  string gateway_id = 1;

  // Optional: New name for the gateway
  string name = 2;

  // Optional: New status for the gateway
  GatewayStatus status = 3;

  // Optional: New type for the gateway
  GatewayType type = 4;

  oneof config {
    // EMQX Gateway configuration
    EMQXGatewayConfig emqx_config = 5;
  }

  // Organization ID owning the gateway
  string organization_id = 6;
}

// Response containing the updated gateway
message UpdateGatewayResponse {
  // The updated gateway with new timestamp
  Gateway gateway = 1;
}

// Request to delete a gateway
message DeleteGatewayRequest {
  // Unique identifier of the gateway to delete
  string gateway_id = 1;

  // Organization ID owning the gateway
  string organization_id = 2;
}

// Response confirming gateway deletion
message DeleteGatewayResponse {
  // Empty response - deletion confirmed by successful RPC
}

// Service for managing device lifecycle
service GatewayService {
  // Register a new gateway
  rpc CreateGateway(CreateGatewayRequest) returns (CreateGatewayResponse);

  // Retrieve a gateway by its ID
  rpc GetGateway(GetGatewayRequest) returns (GetGatewayResponse);

  // List all gateways for an organization
  rpc ListGateways(ListGatewaysRequest) returns (ListGatewaysResponse);

  // Update an existing gateway
  rpc UpdateGateway(UpdateGatewayRequest) returns (UpdateGatewayResponse);

  // Delete a gateway
  rpc DeleteGateway(DeleteGatewayRequest) returns (DeleteGatewayResponse);
}
